#!/usr/bin/env python3
"""
СИІУййТаЄтЄєтіеуЅЕтД┐ті┐т║Њ
Сй┐уће OpenPose Та╝т╝ЈуџёжфеТъХтЏЙ
"""

import requests
from PIL import Image, ImageDraw
import io
from pathlib import Path
import numpy as np

def create_dog_poses():
    """тѕЏт╗║уІЌуџёТаЄтЄєтД┐ті┐жфеТъХтЏЙ"""
    poses_dir = Path("models/pose_library/dog")
    poses_dir.mkdir(parents=True, exist_ok=True)
    
    # тЏЙтЃЈт░║т»И
    width, height = 1024, 1024
    
    # т«џС╣ЅтЁ│жћ«уѓ╣№╝ѕOpenPose Та╝т╝Ј№╝Ѕ
    # Та╝т╝Ј№╝џ(x, y) тЮљТаЄ
    
    # 1. Sit тД┐ті┐№╝ѕтЮљтД┐№╝Ѕ
    sit_keypoints = [
        # тц┤жЃе
        (512, 300),   # ж╝╗тГљ
        (480, 320),   # тидую╝
        (544, 320),   # тЈ│ую╝
        (460, 340),   # тидУђ│
        (564, 340),   # тЈ│Уђ│
        # У║ФСйЊ
        (512, 450),   # жбѕжЃе
        (450, 500),   # тидУѓЕ
        (574, 500),   # тЈ│УѓЕ
        (512, 650),   # УёіТЪ▒СИГжЃе
        # тЅЇУЁ┐№╝ѕтЮљтД┐№╝їтЅЇУЁ┐уЏ┤уФІ№╝Ѕ
        (420, 600),   # тидтЅЇУЁ┐СИі
        (420, 750),   # тидтЅЇУЁ┐СИІ
        (420, 900),   # тидтЅЇуѕф
        (604, 600),   # тЈ│тЅЇУЁ┐СИі
        (604, 750),   # тЈ│тЅЇУЁ┐СИІ
        (604, 900),   # тЈ│тЅЇуѕф
        # тљјУЁ┐№╝ѕтЮљтД┐№╝їтљјУЁ┐т╝»ТЏ▓№╝Ѕ
        (480, 700),   # тидтљјУЁ┐СИі
        (450, 800),   # тидтљјУЁ┐СИГ
        (430, 850),   # тидтљјуѕф
        (544, 700),   # тЈ│тљјУЁ┐СИі
        (574, 800),   # тЈ│тљјУЁ┐СИГ
        (594, 850),   # тЈ│тљјуѕф
        # т░Йти┤
        (512, 750),   # т░Йти┤Та╣жЃе
        (520, 650),   # т░Йти┤СИГжЃе
        (530, 550),   # т░Йти┤т░ќ
    ]
    
    # 2. Walk тД┐ті┐№╝ѕУАїУх░№╝Ѕ
    walk_keypoints = [
        # тц┤жЃе
        (512, 350),   # ж╝╗тГљ
        (480, 370),   # тидую╝
        (544, 370),   # тЈ│ую╝
        (460, 390),   # тидУђ│
        (564, 390),   # тЈ│Уђ│
        # У║ФСйЊ
        (512, 500),   # жбѕжЃе
        (450, 550),   # тидУѓЕ
        (574, 550),   # тЈ│УѓЕ
        (512, 600),   # УёіТЪ▒СИГжЃе
        # тЅЇУЁ┐№╝ѕСИђтЅЇСИђтљј№╝Ѕ
        (420, 650),   # тидтЅЇУЁ┐СИі
        (400, 750),   # тидтЅЇУЁ┐СИІ
        (380, 850),   # тидтЅЇуѕф№╝ѕтљЉтЅЇ№╝Ѕ
        (604, 650),   # тЈ│тЅЇУЁ┐СИі
        (624, 750),   # тЈ│тЅЇУЁ┐СИІ
        (644, 850),   # тЈ│тЅЇуѕф№╝ѕтљЉтљј№╝Ѕ
        # тљјУЁ┐№╝ѕСИђтЅЇСИђтљј№╝Ѕ
        (480, 650),   # тидтљјУЁ┐СИі
        (460, 750),   # тидтљјУЁ┐СИГ
        (440, 850),   # тидтљјуѕф№╝ѕтљЉтљј№╝Ѕ
        (544, 650),   # тЈ│тљјУЁ┐СИі
        (564, 750),   # тЈ│тљјУЁ┐СИГ
        (584, 850),   # тЈ│тљјуѕф№╝ѕтљЉтЅЇ№╝Ѕ
        # т░Йти┤№╝ѕТ░┤т╣│№╝Ѕ
        (512, 650),   # т░Йти┤Та╣жЃе
        (450, 630),   # т░Йти┤СИГжЃе
        (380, 610),   # т░Йти┤т░ќ
    ]
    
    # 3. Rest тД┐ті┐№╝ѕУХ┤уЮђС╝ЉТЂ»№╝Ѕ
    rest_keypoints = [
        # тц┤жЃе№╝ѕСйјтъѓ№╝Ѕ
        (512, 500),   # ж╝╗тГљ
        (480, 520),   # тидую╝
        (544, 520),   # тЈ│ую╝
        (460, 540),   # тидУђ│
        (564, 540),   # тЈ│Уђ│
        # У║ФСйЊ№╝ѕУХ┤СИІ№╝Ѕ
        (512, 600),   # жбѕжЃе
        (450, 650),   # тидУѓЕ
        (574, 650),   # тЈ│УѓЕ
        (512, 700),   # УёіТЪ▒СИГжЃе
        # тЅЇУЁ┐№╝ѕтљЉтЅЇС╝Ит▒Ћ№╝Ѕ
        (400, 700),   # тидтЅЇУЁ┐СИі
        (350, 750),   # тидтЅЇУЁ┐СИІ
        (300, 800),   # тидтЅЇуѕф
        (624, 700),   # тЈ│тЅЇУЁ┐СИі
        (674, 750),   # тЈ│тЅЇУЁ┐СИІ
        (724, 800),   # тЈ│тЅЇуѕф
        # тљјУЁ┐№╝ѕтљЉтљјт╝»ТЏ▓№╝Ѕ
        (480, 720),   # тидтљјУЁ┐СИі
        (450, 780),   # тидтљјУЁ┐СИГ
        (430, 820),   # тидтљјуѕф
        (544, 720),   # тЈ│тљјУЁ┐СИі
        (574, 780),   # тЈ│тљјУЁ┐СИГ
        (594, 820),   # тЈ│тљјуѕф
        # т░Йти┤№╝ѕТћЙТЮЙ№╝Ѕ
        (512, 750),   # т░Йти┤Та╣жЃе
        (480, 770),   # т░Йти┤СИГжЃе
        (450, 790),   # т░Йти┤т░ќ
    ]
    
    # 4. Sleep тД┐ті┐№╝ѕСЙДтЇДуЮАУДЅ№╝Ѕ
    sleep_keypoints = [
        # тц┤жЃе№╝ѕСЙДтЇД№╝Ѕ
        (400, 550),   # ж╝╗тГљ
        (380, 570),   # тидую╝
        (420, 570),   # тЈ│ую╝
        (360, 590),   # тидУђ│
        (440, 590),   # тЈ│Уђ│
        # У║ФСйЊ№╝ѕСЙДтЇД№╝Ѕ
        (500, 600),   # жбѕжЃе
        (550, 650),   # тидУѓЕ
        (550, 550),   # тЈ│УѓЕ
        (650, 650),   # УёіТЪ▒СИГжЃе
        # тЅЇУЁ┐№╝ѕУюиу╝Е№╝Ѕ
        (520, 700),   # тидтЅЇУЁ┐СИі
        (500, 750),   # тидтЅЇУЁ┐СИІ
        (480, 780),   # тидтЅЇуѕф
        (580, 650),   # тЈ│тЅЇУЁ┐СИі
        (600, 700),   # тЈ│тЅЇУЁ┐СИІ
        (620, 730),   # тЈ│тЅЇуѕф
        # тљјУЁ┐№╝ѕУюиу╝Е№╝Ѕ
        (680, 700),   # тидтљјУЁ┐СИі
        (700, 750),   # тидтљјУЁ┐СИГ
        (720, 780),   # тидтљјуѕф
        (640, 650),   # тЈ│тљјУЁ┐СИі
        (620, 700),   # тЈ│тљјУЁ┐СИГ
        (600, 730),   # тЈ│тљјуѕф
        # т░Йти┤№╝ѕУюиу╝Е№╝Ѕ
        (700, 680),   # т░Йти┤Та╣жЃе
        (720, 650),   # т░Йти┤СИГжЃе
        (740, 620),   # т░Йти┤т░ќ
    ]
    
    poses = {
        "sit": sit_keypoints,
        "walk": walk_keypoints,
        "rest": rest_keypoints,
        "sleep": sleep_keypoints,
    }
    
    # ућЪТѕљжфеТъХтЏЙ
    for pose_name, keypoints in poses.items():
        img = draw_skeleton(keypoints, width, height)
        img.save(poses_dir / f"{pose_name}.png")
        print(f"РюЁ ућЪТѕљ {pose_name} тД┐ті┐жфеТъХтЏЙ")

def draw_skeleton(keypoints, width, height):
    """у╗ўтѕХжфеТъХтЏЙ"""
    # тѕЏт╗║уЎйУЅ▓УЃїТЎ»
    img = Image.new('RGB', (width, height), 'white')
    draw = ImageDraw.Draw(img)
    
    # т«џС╣ЅжфеТъХУ┐ъТјЦ№╝ѕтЊфС║ЏтЁ│жћ«уѓ╣С╣ІжЌ┤жюђУдЂУ┐ъу║┐№╝Ѕ
    connections = [
        # тц┤жЃе
        (0, 1), (0, 2), (1, 3), (2, 4),  # ж╝╗тГљ-ую╝уЮЏ-Уђ│Тюх
        (1, 2),  # тидую╝-тЈ│ую╝
        # У║ФСйЊ
        (0, 5), (5, 6), (5, 7), (5, 8),  # ж╝╗тГљ-жбѕжЃе-УѓЕУєђ-УёіТЪ▒
        (6, 7),  # тидУѓЕ-тЈ│УѓЕ
        # тидтЅЇУЁ┐
        (6, 9), (9, 10), (10, 11),
        # тЈ│тЅЇУЁ┐
        (7, 12), (12, 13), (13, 14),
        # тидтљјУЁ┐
        (8, 15), (15, 16), (16, 17),
        # тЈ│тљјУЁ┐
        (8, 18), (18, 19), (19, 20),
        # т░Йти┤
        (8, 21), (21, 22), (22, 23),
    ]
    
    # у╗ўтѕХУ┐ъТјЦу║┐
    for start_idx, end_idx in connections:
        if start_idx < len(keypoints) and end_idx < len(keypoints):
            start = keypoints[start_idx]
            end = keypoints[end_idx]
            draw.line([start, end], fill='black', width=8)
    
    # у╗ўтѕХтЁ│жћ«уѓ╣
    for point in keypoints:
        x, y = point
        r = 12  # тЁ│жћ«уѓ╣тЇітЙё
        draw.ellipse([x-r, y-r, x+r, y+r], fill='red', outline='black', width=2)
    
    return img

def main():
    print("­Ъје т╝ђтДІућЪТѕљтіеуЅЕтД┐ті┐т║Њ...")
    print()
    
    # тѕЏт╗║уІЌуџётД┐ті┐
    create_dog_poses()
    
    print()
    print("=" * 70)
    print("РюЁ тД┐ті┐т║ЊућЪТѕљт«їТѕљ№╝Ђ")
    print("=" * 70)
    print("­ЪЊЂ СйЇуй«: models/pose_library/dog/")
    print("­ЪЊі тїЁтљФтД┐ті┐:")
    print("   - sit.png   (тЮљтД┐)")
    print("   - walk.png  (УАїУх░)")
    print("   - rest.png  (УХ┤уЮђС╝ЉТЂ»)")
    print("   - sleep.png (СЙДтЇДуЮАУДЅ)")

if __name__ == "__main__":
    main()

