# AIå›¾ç‰‡å†…å®¹æ£€æŸ¥é›†æˆæ–‡æ¡£

## âœ… å®Œæˆçš„å·¥ä½œ

### 1. åˆ›å»ºAIå†…å®¹å®¡æ ¸æ¨¡å— (`backend/utils/ai_content_checker.py`)

åŸºäº **Google Gemini 2.0 Flash** çš„AIå›¾ç‰‡å†…å®¹åˆ†ææ¨¡å—ï¼Œæä¾›å…¨é¢çš„å›¾ç‰‡è´¨é‡æ£€æµ‹ï¼š

#### ä¸»è¦åŠŸèƒ½ï¼š
- **å†…å®¹å®‰å…¨æ£€æµ‹** - è¯†åˆ«ä¸è‰¯å†…å®¹ï¼ˆè‰²æƒ…/æš´åŠ›/è™å¾…ç­‰ï¼‰
- **å® ç‰©æ£€æµ‹** - è¯†åˆ«çŒ«/ç‹—ï¼Œæ£€æµ‹æ•°é‡å’Œç½®ä¿¡åº¦
- **å§¿åŠ¿åˆ†æ** - åˆ¤æ–­åå§¿/ç«™å§¿/èººå§¿ç­‰ï¼Œæ¨èåå§¿å›¾ç‰‡
- **èƒŒæ™¯è´¨é‡è¯„ä¼°** - è¯„ä¼°èƒŒæ™¯å¤æ‚åº¦å’Œå»é™¤éš¾åº¦
- **ç‰¹å¾å®Œæ•´æ€§æ£€æŸ¥** - æ£€æµ‹å® ç‰©ç‰¹å¾å®Œæ•´åº¦ï¼ˆé¢éƒ¨ã€è€³æœµã€å››è‚¢ç­‰ï¼‰
- **æ•´ä½“è¯„ä¼°** - ç»¼åˆåˆ¤æ–­æ˜¯å¦é€‚åˆç”Ÿæˆ

#### æŠ€æœ¯ç‰¹ç‚¹ï¼š
- ä½¿ç”¨ Gemini 2.0 Flash Experimentalï¼ˆæœ€æ–°ã€æœ€å¿«ã€å…è´¹é¢åº¦å¤§ï¼‰
- ç»“æ„åŒ–JSONè¾“å‡ºï¼Œæ–¹ä¾¿è§£æ
- å®Œæ•´çš„é”™è¯¯å¤„ç†æœºåˆ¶
- æ”¯æŒå¤šç»´åº¦åˆ†æå’Œå»ºè®®

---

### 2. å¢å¼ºå›¾ç‰‡éªŒè¯å™¨ (`backend/utils/image_validator.py`)

#### æ–°å¢åŠŸèƒ½ï¼š
- **åˆ†çº§éªŒè¯ç³»ç»Ÿ**
  - `pass` - å®Œå…¨é€šè¿‡
  - `warning` - è­¦å‘Šä½†å¯ç»§ç»­
  - `error` - ä¸¥é‡é”™è¯¯ï¼Œæ‹’ç»å¤„ç†

- **AIå†…å®¹æ£€æŸ¥é›†æˆ**
  - å¯é€‰å¯ç”¨AIæ£€æŸ¥ï¼ˆé€šè¿‡ `enable_ai_check` å‚æ•°ï¼‰
  - è¯¦ç»†çš„é”™è¯¯å’Œè­¦å‘Šåˆ†ç±»
  - æ™ºèƒ½å»ºè®®ç³»ç»Ÿ

- **å¢å¼ºçš„è´¨é‡æ£€æµ‹**
  - å›¾ç‰‡æ¸…æ™°åº¦åˆ†æ
  - åˆ†è¾¨ç‡å»ºè®®
  - å®½é«˜æ¯”æ£€æŸ¥

---

### 3. é…ç½®ç®¡ç† (`backend/config.py`)

æ·»åŠ äº†Google AI APIé…ç½®ï¼š

```python
# Google Gemini APIå¯†é’¥ï¼ˆå¯é€‰ï¼Œç”¨äºAIå›¾ç‰‡é¢„å¤„ç†ï¼‰
GOOGLE_API_KEY = os.getenv("AIzaSyDod7iQJFtUNMOkt-fRDtRjDck9bMXbftc", "")

# æ˜¯å¦å¯ç”¨AIå›¾ç‰‡é¢„å¤„ç†ï¼ˆé»˜è®¤å¯ç”¨ï¼Œå¦‚æœæœ‰API Keyï¼‰
ENABLE_AI_IMAGE_CHECK = os.getenv("ENABLE_AI_IMAGE_CHECK", "true").lower() in ("true", "1", "yes")
```

---

### 4. APIç«¯ç‚¹é›†æˆ

#### âœ… `/api/kling/generate` - å®Œæ•´ç”Ÿæˆæµç¨‹
- å·²é›†æˆAIå›¾ç‰‡éªŒè¯
- ä¸Šä¼ æ—¶è‡ªåŠ¨æ£€æŸ¥å›¾ç‰‡è´¨é‡
- æ‹’ç»ä¸åˆæ ¼å›¾ç‰‡ï¼Œæä¾›è¯¦ç»†é”™è¯¯ä¿¡æ¯
- è­¦å‘Šä¿¡æ¯ä¸é˜»æ­¢æµç¨‹ï¼Œä½†ä¼šè®°å½•

#### âœ… `/api/kling/init` - åˆå§‹åŒ–ä»»åŠ¡
- å·²é›†æˆAIå›¾ç‰‡éªŒè¯
- ä¸ `/generate` ç«¯ç‚¹ä¿æŒä¸€è‡´çš„éªŒè¯é€»è¾‘
- éªŒè¯ç»“æœä¿å­˜åœ¨ä»»åŠ¡çŠ¶æ€ä¸­

---

### 5. æµ‹è¯•å·¥å…·

åˆ›å»ºäº†å®Œæ•´çš„æµ‹è¯•è„šæœ¬ `backend/test_ai_checker.py`ï¼š

```bash
# è‡ªåŠ¨æµ‹è¯•ï¼ˆæŸ¥æ‰¾æµ‹è¯•å›¾ç‰‡ï¼‰
python3 backend/test_ai_checker.py

# æŒ‡å®šå›¾ç‰‡æµ‹è¯•
python3 backend/test_ai_checker.py /path/to/your/image.jpg
```

æµ‹è¯•å†…å®¹ï¼š
- âœ… é…ç½®æ£€æŸ¥
- âœ… æ¨¡å—å¯¼å…¥
- âœ… AIæ£€æŸ¥å™¨åˆå§‹åŒ–
- âœ… å›¾ç‰‡åˆ†æåŠŸèƒ½
- âœ… é›†æˆéªŒè¯æµç¨‹

---

## ğŸ“‹ ä½¿ç”¨æŒ‡å—

### 1. å®‰è£…ä¾èµ–

```bash
pip install google-generativeai pillow python-magic-bin
```

### 2. é…ç½®APIå¯†é’¥

æœ‰ä¸‰ç§æ–¹å¼é…ç½® Google API å¯†é’¥ï¼š

#### æ–¹å¼1: ç¯å¢ƒå˜é‡ï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰
```bash
export GOOGLE_API_KEY="your-google-api-key-here"
export ENABLE_AI_IMAGE_CHECK="true"
```

#### æ–¹å¼2: .envæ–‡ä»¶ï¼ˆæ¨èå¼€å‘ç¯å¢ƒï¼‰
åœ¨é¡¹ç›®æ ¹ç›®å½•æˆ– `backend/.env` æ–‡ä»¶ä¸­æ·»åŠ ï¼š
```env
GOOGLE_API_KEY=your-google-api-key-here
ENABLE_AI_IMAGE_CHECK=true
```

#### æ–¹å¼3: Renderç­‰éƒ¨ç½²å¹³å°
åœ¨ç¯å¢ƒå˜é‡è®¾ç½®ä¸­æ·»åŠ ï¼š
- `GOOGLE_API_KEY`: ä½ çš„APIå¯†é’¥
- `ENABLE_AI_IMAGE_CHECK`: `true`

### 3. è·å–Google APIå¯†é’¥

1. è®¿é—® [Google AI Studio](https://aistudio.google.com/app/apikey)
2. ç‚¹å‡» "Create API Key"
3. å¤åˆ¶ç”Ÿæˆçš„å¯†é’¥
4. æŒ‰ç…§ä¸Šè¿°æ–¹å¼é…ç½®

### 4. å…³é—­AIæ£€æŸ¥ï¼ˆå¯é€‰ï¼‰

å¦‚æœä¸éœ€è¦AIæ£€æŸ¥åŠŸèƒ½ï¼Œå¯ä»¥è®¾ç½®ï¼š
```bash
export ENABLE_AI_IMAGE_CHECK="false"
```

ç³»ç»Ÿä¼šå›é€€åˆ°åŸºç¡€éªŒè¯ï¼ˆæ–‡ä»¶å¤§å°ã€æ ¼å¼ã€å°ºå¯¸ç­‰ï¼‰ã€‚

---

## ğŸ” APIå“åº”æ ¼å¼

### éªŒè¯é€šè¿‡ï¼ˆpassï¼‰

```json
{
  "pet_id": "pet_1234567890",
  "status": "processing",
  "message": "ä»»åŠ¡å·²åˆ›å»ºï¼Œæ­£åœ¨åå°å¤„ç†ä¸­...",
  "note": "è¯·ä½¿ç”¨ GET /api/kling/status/{pet_id} æŸ¥è¯¢è¿›åº¦"
}
```

### éªŒè¯è­¦å‘Šï¼ˆwarningï¼‰

å›¾ç‰‡å¯ä»¥ç»§ç»­å¤„ç†ï¼Œä½†ä¼šè®°å½•è­¦å‘Šï¼š

```json
{
  "pet_id": "pet_1234567890",
  "status": "processing",
  "message": "ä»»åŠ¡å·²åˆ›å»ºï¼Œæ­£åœ¨åå°å¤„ç†ä¸­...",
  "warnings": [
    "å® ç‰©å§¿åŠ¿ä¸ºstandingï¼Œæ¨èä½¿ç”¨åå§¿å›¾ç‰‡ä»¥è·å¾—æœ€ä½³ç”Ÿæˆæ•ˆæœ",
    "èƒŒæ™¯å¤æ‚(complex)ï¼Œå¯èƒ½éš¾ä»¥å®Œå…¨å»é™¤"
  ]
}
```

### éªŒè¯å¤±è´¥ï¼ˆerrorï¼‰

```json
{
  "error": "å›¾ç‰‡éªŒè¯å¤±è´¥",
  "messages": [
    "æœªæ£€æµ‹åˆ°å® ç‰©ï¼Œè¯·ç¡®ä¿å›¾ç‰‡ä¸­åŒ…å«æ¸…æ™°çš„çŒ«æˆ–ç‹—",
    "å›¾ç‰‡åŒ…å«ä¸è‰¯å†…å®¹: æš´åŠ›å†…å®¹"
  ],
  "severity": "error",
  "details": {
    "valid": false,
    "errors": [...],
    "warnings": [...],
    "metrics": {...}
  }
}
```

---

## ğŸ“Š AIåˆ†æç»“æœç»“æ„

```json
{
  "content_safety": {
    "safe": true,
    "issues": []
  },
  "pet_detection": {
    "detected": true,
    "species": "cat",
    "confidence": 0.95,
    "count": 1
  },
  "pose_analysis": {
    "posture": "sitting",
    "is_sitting": true,
    "clarity": 0.9,
    "description": "å® ç‰©æ­£é¢åå§¿ï¼Œå§¿æ€ç«¯æ­£",
    "suggestions": []
  },
  "background_quality": {
    "type": "simple",
    "is_clean": true,
    "removal_difficulty": "easy",
    "has_distractions": false,
    "description": "ç™½è‰²ç®€æ´èƒŒæ™¯",
    "suggestions": []
  },
  "feature_completeness": {
    "completeness_score": 0.95,
    "visible_features": ["face", "ears", "eyes", "nose", "body", "legs"],
    "missing_features": [],
    "occlusions": [],
    "angle_quality": "frontal",
    "lighting_quality": "good",
    "focus_quality": "sharp",
    "suggestions": []
  },
  "overall_assessment": {
    "suitable_for_generation": true,
    "confidence_score": 0.92,
    "severity_level": "pass",
    "primary_issues": [],
    "summary": "å›¾ç‰‡è´¨é‡ä¼˜ç§€ï¼Œéå¸¸é€‚åˆç”¨äºç”Ÿæˆå® ç‰©åŠ¨ç”»",
    "recommendations": []
  }
}
```

---

## ğŸ’¡ æœ€ä½³å®è·µå»ºè®®

### æ¨èçš„å›¾ç‰‡ç‰¹å¾ï¼š

1. **å§¿åŠ¿**: åå§¿æœ€ä½³
2. **èƒŒæ™¯**: çº¯è‰²æˆ–ç®€æ´èƒŒæ™¯
3. **è§’åº¦**: æ­£é¢æˆ–å››åˆ†ä¹‹ä¸‰è§’åº¦
4. **æ¸…æ™°åº¦**: é«˜æ¸…ã€å¯¹ç„¦å‡†ç¡®
5. **å…‰ç…§**: å‡åŒ€ã€å……è¶³
6. **ç‰¹å¾**: é¢éƒ¨ã€è€³æœµã€å››è‚¢æ¸…æ™°å¯è§
7. **æ•°é‡**: ä»…åŒ…å«ä¸€åªå® ç‰©

### å¸¸è§æ‹’ç»åŸå› ï¼š

1. **æœªæ£€æµ‹åˆ°å® ç‰©** - å›¾ç‰‡ä¸­æ²¡æœ‰çŒ«æˆ–ç‹—
2. **æ£€æµ‹åˆ°å¤šåªå® ç‰©** - å»ºè®®å•ç‹¬æ‹æ‘„
3. **å†…å®¹ä¸å®‰å…¨** - åŒ…å«ä¸è‰¯å†…å®¹
4. **å›¾ç‰‡è´¨é‡è¿‡ä½** - å°ºå¯¸å¤ªå°ã€è¿‡äºæ¨¡ç³Š
5. **ç‰¹å¾ä¸å®Œæ•´** - å® ç‰©è¢«ä¸¥é‡é®æŒ¡

---

## ğŸš€ æ€§èƒ½å’Œæˆæœ¬

### Google Gemini 2.0 Flash
- **å…è´¹é¢åº¦**: 1500æ¬¡è¯·æ±‚/å¤©
- **é€Ÿåº¦**: éå¸¸å¿«ï¼ˆ<2ç§’/å¼ ï¼‰
- **å‡†ç¡®åº¦**: é«˜
- **æˆæœ¬**: å…è´¹é¢åº¦å†…å®Œå…¨å…è´¹

### å¯¹æ¯”å…¶ä»–æ–¹æ¡ˆ
| API | å…è´¹é¢åº¦ | é€Ÿåº¦ | å‡†ç¡®åº¦ | æˆæœ¬ï¼ˆä»˜è´¹ï¼‰ |
|-----|---------|------|--------|-------------|
| **Gemini 2.0 Flash** | 1500/å¤© | âš¡âš¡âš¡ | â­â­â­â­â­ | æä½ |
| Claude | æ— å…è´¹ | âš¡âš¡ | â­â­â­â­â­ | ä¸­ |
| GPT-4 Vision | æ— å…è´¹ | âš¡ | â­â­â­â­â­ | é«˜ |

---

## ğŸ”§ æ•…éšœæ’é™¤

### é—®é¢˜1: "æœªè®¾ç½® GOOGLE_API_KEY"
**è§£å†³**: æŒ‰ç…§ä¸Šè¿°é…ç½®æŒ‡å—è®¾ç½®APIå¯†é’¥

### é—®é¢˜2: "google-generativeai æœªå®‰è£…"
**è§£å†³**:
```bash
pip install google-generativeai
```

### é—®é¢˜3: AIæ£€æŸ¥å¤±è´¥ä½†ä¸å½±å“ä¸Šä¼ 
**åŸå› **: AIæ£€æŸ¥å¤±è´¥æ—¶ç³»ç»Ÿä¼šå›é€€åˆ°åŸºç¡€éªŒè¯
**è§£å†³**: æ£€æŸ¥APIå¯†é’¥æ˜¯å¦æ­£ç¡®ï¼Œç½‘ç»œæ˜¯å¦æ­£å¸¸

### é—®é¢˜4: "è¯·æ±‚é…é¢å·²ç”¨å®Œ"
**åŸå› **: è¶…è¿‡å…è´¹é¢åº¦é™åˆ¶ï¼ˆ1500æ¬¡/å¤©ï¼‰
**è§£å†³**:
1. ç­‰å¾…ç¬¬äºŒå¤©é‡ç½®
2. å‡çº§åˆ°ä»˜è´¹è®¡åˆ’
3. ä¸´æ—¶å…³é—­AIæ£€æŸ¥: `ENABLE_AI_IMAGE_CHECK=false`

---

## ğŸ“ ä»£ç ç¤ºä¾‹

### Pythonç›´æ¥è°ƒç”¨

```python
from backend.utils.ai_content_checker import check_image_with_ai

# åˆ†æå›¾ç‰‡
result = check_image_with_ai(
    image_path="/path/to/image.jpg",
    api_key="your-google-api-key"
)

# æ£€æŸ¥ç»“æœ
if result['overall_assessment']['suitable_for_generation']:
    print("âœ… å›¾ç‰‡é€‚åˆç”Ÿæˆ")
else:
    print("âŒ å›¾ç‰‡ä¸é€‚åˆ:", result['overall_assessment']['summary'])
```

### é›†æˆéªŒè¯

```python
from backend.utils.image_validator import validate_image

# å®Œæ•´éªŒè¯ï¼ˆåŒ…æ‹¬AIæ£€æŸ¥ï¼‰
validation_result = validate_image(
    file_path="/path/to/image.jpg",
    strict_mode=False,
    enable_ai_check=True,
    google_api_key="your-google-api-key"
)

# å¤„ç†ç»“æœ
if validation_result['valid']:
    print("âœ… éªŒè¯é€šè¿‡")
    if validation_result['warnings']:
        print("âš ï¸ è­¦å‘Š:", validation_result['warnings'])
else:
    print("âŒ éªŒè¯å¤±è´¥:", validation_result['errors'])
```

---

## âœ… æ€»ç»“

AIå›¾ç‰‡å†…å®¹æ£€æŸ¥å·²æˆåŠŸé›†æˆåˆ°ä»¥ä¸‹ç«¯ç‚¹ï¼š
- âœ… `/api/kling/generate` - å®Œæ•´ç”Ÿæˆæµç¨‹
- âœ… `/api/kling/init` - ä»»åŠ¡åˆå§‹åŒ–

### åŠŸèƒ½ç‰¹ç‚¹ï¼š
- ğŸ¤– æ™ºèƒ½AIåˆ†æï¼ˆGemini 2.0 Flashï¼‰
- ğŸ›¡ï¸ åˆ†çº§éªŒè¯ç³»ç»Ÿï¼ˆpass/warning/errorï¼‰
- ğŸ“Š è¯¦ç»†çš„é”™è¯¯å’Œå»ºè®®
- ğŸ¯ å¯é€‰å¯ç”¨/å…³é—­
- ğŸ†“ å…è´¹é¢åº¦å……è¶³ï¼ˆ1500æ¬¡/å¤©ï¼‰
- âš¡ å“åº”å¿«é€Ÿï¼ˆ<2ç§’ï¼‰

### ä¸‹ä¸€æ­¥å»ºè®®ï¼š
1. è®¾ç½® GOOGLE_API_KEY
2. è¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯åŠŸèƒ½
3. åœ¨å®é™…ç¯å¢ƒä¸­æµ‹è¯•ä¸Šä¼ æµç¨‹
4. æ ¹æ®éœ€è¦è°ƒæ•´éªŒè¯ç­–ç•¥

---

**éœ€è¦å¸®åŠ©?** è¯·æŸ¥é˜… [Google AI Studio æ–‡æ¡£](https://ai.google.dev/docs) æˆ–æäº¤Issueã€‚
