# 视频帧提取功能说明

## 🎯 **新增功能**

在视频裁剪页面新增了两个按钮：
1. **保存首帧** - 提取视频第一帧并保存为图片（JPG格式）
2. **保存尾帧** - 提取视频最后一帧并保存为图片（JPG格式）

---

## 📱 **使用方法**

### **步骤 1：选择视频**
1. 打开应用，点击底部导航栏的 **"裁剪视频"** 📹
2. 点击 **"选择视频"** 按钮
3. 从相册中选择一个视频

### **步骤 2：提取并保存帧**
选择视频后，你会看到三个按钮：
- **开始裁剪** （橙色） - 裁剪视频
- **保存首帧** （蓝色） - 提取第一帧并自动保存
- **保存尾帧** （紫色） - 提取最后一帧并自动保存

点击 **"保存首帧"** 或 **"保存尾帧"** 后：
1. 等待提取完成（1-2秒）
2. 授予存储权限（如果需要）
3. 图片会自动保存到手机相册
4. 显示"✅ 首帧已保存到相册！"提示

---

## 🎨 **界面预览**

```
┌─────────────────────────────────┐
│  视频信息                        │
│  分辨率: 880 x 1044             │
│  帧率: 24.00 FPS                │
│  总帧数: 121 帧                 │
│  时长: 00:05.0                  │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│  裁剪设置                        │
│  （时间滑块和快捷按钮）          │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│      [开始裁剪]                  │
│                                 │
│  [保存首帧]    [保存尾帧]       │
└─────────────────────────────────┘

点击后自动保存，无需预览！
```

---

## 🔧 **技术实现**

### **后端 API**

**端点**: `POST /api/video/extract-frame`

**参数**:
- `video`: 视频文件
- `frame_type`: `"first"` 或 `"last"`

**返回**: JPG 图片文件

**示例**:
```python
# 提取首帧
extract_frame(video_path, frame_index=0, output_path)

# 提取尾帧
extract_frame(video_path, frame_index=-1, output_path)
```

### **前端服务**

```dart
// 提取首帧
final frameFile = await VideoTrimmingService.extractFrame(
  videoFile: videoFile,
  frameType: 'first',
);

// 提取尾帧
final frameFile = await VideoTrimmingService.extractFrame(
  videoFile: videoFile,
  frameType: 'last',
);
```

---

## 📊 **功能对比**

| 功能 | 输出格式 | 用途 |
|------|---------|------|
| **裁剪视频** | MP4 视频 | 保留视频的一部分（按时间范围） |
| **保存首帧** | JPG 图片 | 提取视频第一帧作为封面图 |
| **保存尾帧** | JPG 图片 | 提取视频最后一帧作为结束图 |

---

## 💡 **使用场景**

### **场景 1：制作视频封面**
1. 选择视频
2. 点击 **"保存首帧"**
3. 图片自动保存到相册，可作为封面图

### **场景 2：对比前后效果**
1. 点击"保存首帧"（动画开始前）
2. 点击"保存尾帧"（动画结束后）
3. 打开相册对比两张图片，查看动画效果

### **场景 3：快速提取关键帧**
- 如果视频的第一帧或最后一帧是关键画面
- 一键提取并保存，无需手动截图

---

## 🎯 **优势**

✅ **快速** - 只提取一帧，速度很快（1-2秒）
✅ **简单** - 一键操作，自动保存，无需手动截图
✅ **高质量** - 直接从视频提取，无压缩损失
✅ **方便** - 自动保存到相册，可以直接分享
✅ **无预览** - 点击即保存，流程更简洁

---

## 📝 **注意事项**

1. **权限要求**
   - Android: 需要 `READ_MEDIA_VIDEO` 和 `WRITE_EXTERNAL_STORAGE` 权限
   - iOS: 需要 `Photos` 权限

2. **文件格式**
   - 输出格式：JPG
   - 分辨率：与原视频相同
   - 质量：高质量（OpenCV 默认设置）

3. **临时文件**
   - 提取的图片会先保存到临时目录
   - 保存到相册后会立即自动删除临时文件
   - 无需手动清理

---

## 🚀 **下一步**

现在你可以：
1. **重新运行 Flutter 应用**（代码已更新）
   ```bash
   flutter run
   ```

2. **测试功能**
   - 选择一个视频
   - 点击"保存首帧"或"保存尾帧"
   - 等待1-2秒
   - 看到"✅ 首帧已保存到相册！"提示

3. **查看相册**
   - 打开手机相册
   - 查找刚才保存的图片
   - 图片会在最近添加的位置

---

## 🎉 **完成！**

现在你的视频裁剪页面有三个功能：
1. ✅ 裁剪视频（按时间范围）
2. ✅ 保存首帧（提取第一帧图片）
3. ✅ 保存尾帧（提取最后一帧图片）

所有功能都支持保存到相册！📱

